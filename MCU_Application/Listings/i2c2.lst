C51 COMPILER V9.59.0.0   I2C2                                                              12/15/2018 23:49:20 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE I2C2
OBJECT MODULE PLACED IN .\Objects\i2c2.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Driver\i2c2.c COMPACT OPTIMIZE(8,SPEED) REGFILE(.\Objects\dwLaser_F020.O
                    -RC) BROWSE ORDER INCDIR(.\Lib;.\Driver;.\MainApp;.\Modbus) DEBUG OBJECTEXTEND PRINT(.\Listings\i2c2.lst) OBJECT(.\Object
                    -s\i2c2.obj)

line level    source

   1          #include "i2c2.h"
   2          /*****************************************************************************/
   3          sbit SDA2 = P3^3;
*** ERROR C202 IN LINE 3 OF Driver\i2c2.c: 'P3': undefined identifier
   4          sbit SCL2 = P3^4;                               
*** ERROR C202 IN LINE 4 OF Driver\i2c2.c: 'P3': undefined identifier
   5          /*****************************************************************************/
   6          void iic2Init(void){
   7   1      }
   8          static void setSCL2(uint8_t s){
   9   1              if(s)
  10   1                      SCL2 = 1;
*** ERROR C202 IN LINE 10 OF Driver\i2c2.c: 'SCL2': undefined identifier
  11   1              else
  12   1                      SCL2 = 0;
*** ERROR C202 IN LINE 12 OF Driver\i2c2.c: 'SCL2': undefined identifier
  13   1      }
  14          static void setSDA2(uint8_t s){
  15   1              if(s)
  16   1                      SDA2 = 1;
*** ERROR C202 IN LINE 16 OF Driver\i2c2.c: 'SDA2': undefined identifier
  17   1              else
  18   1                      SDA2 = 0;
*** ERROR C202 IN LINE 18 OF Driver\i2c2.c: 'SDA2': undefined identifier
  19   1      }
  20          static uint8_t getSCL2(void){
  21   1              return SCL2;
*** ERROR C202 IN LINE 21 OF Driver\i2c2.c: 'SCL2': undefined identifier
  22   1      }
  23          static uint8_t getSDA2(void){
  24   1              return SDA2; 
*** ERROR C202 IN LINE 24 OF Driver\i2c2.c: 'SDA2': undefined identifier
  25   1      }
  26          void iic2Start(void){//产生IIC起始信号
  27   1              setSDA2(1);               
  28   1              setSCL2(1);
  29   1              delayUs(CONFIG_EPROM_FREQ);
  30   1              setSDA2(0);//START:when CLK is high,DATA change form high to low 
  31   1              delayUs(CONFIG_EPROM_FREQ);
  32   1              setSCL2(0);//钳住I2C总线，准备发送或接收数据 
  33   1      }         
  34          void iic2Stop(void){//产生IIC停止信号
  35   1              setSCL2(0);
  36   1              setSDA2(0);//STOP:when CLK is high DATA change form low to high
  37   1              delayUs(CONFIG_EPROM_FREQ);
  38   1              setSCL2(1); 
  39   1              setSDA2(1);//发送I2C总线结束信号
  40   1              delayUs(CONFIG_EPROM_FREQ);                                                             
  41   1      }
  42          
  43          uint8_t iic2WaitAck(void){
  44   1      //发送数据后，等待应答信号到来
  45   1      //返回值：1，接收应答失败，IIC直接退出
C51 COMPILER V9.59.0.0   I2C2                                                              12/15/2018 23:49:20 PAGE 2   

  46   1      //        0，接收应答成功，什么都不做
  47   1              uint8_t ucErrTime=0;  
  48   1              setSDA2(1);
  49   1              delayUs(1);        
  50   1              setSCL2(1);
  51   1              delayUs(1);      
  52   1              while(getSDA2()){
  53   2                      ucErrTime ++;
  54   2                      if(ucErrTime >= 250){
  55   3                              iic2Stop();
  56   3                              return 1;
  57   3                      }
  58   2              }
  59   1              setSCL2(0);    //时钟输出0         
  60   1              return 0;  
  61   1      }
  62          void iic2Ack(void){//产生ACK应答
  63   1              setSCL2(0);
  64   1              setSDA2(0);
  65   1              delayUs(CONFIG_EPROM_FREQ);
  66   1              setSCL2(1);
  67   1              delayUs(CONFIG_EPROM_FREQ);
  68   1              setSCL2(0);
  69   1      }
  70                      
  71          void iic2NAck(void){//不产生ACK应答     
  72   1              setSCL2(0);
  73   1              setSDA2(1);
  74   1              delayUs(CONFIG_EPROM_FREQ);
  75   1              setSCL2(1);
  76   1              delayUs(CONFIG_EPROM_FREQ);
  77   1              setSCL2(0);
  78   1      }                                                                                 
  79          void iic2SendByte(uint8_t txd){//IIC发送一个字节
  80   1      //返回从机有无应答
  81   1      //1，有应答
  82   1      //0，无应答                        
  83   1          uint8_t t;              
  84   1          setSCL2(0);//拉低时钟开始数据传输
  85   1          for(t = 0;t < 8;t ++)
  86   1          {              
  87   2              //SDA2=(txd&0x80)>>7;
  88   2                      if((txd & 0x80) >> 7)
  89   2                              setSDA2(1);
  90   2                      else
  91   2                              setSDA2(0);
  92   2                      txd <<= 1;        
  93   2                      delayUs(CONFIG_EPROM_FREQ);
  94   2                      setSCL2(1);
  95   2                      delayUs(CONFIG_EPROM_FREQ); 
  96   2                      setSCL2(0);     
  97   2                      delayUs(CONFIG_EPROM_FREQ);
  98   2          }    
  99   1      }           
 100            
 101          uint8_t iic2ReadByte(uint8_t ack){//读1个字节，ack=1时，发送ACK，ack=0，发送nACK 
 102   1              uint8_t i, receive=0;
 103   1          for(i=0;i<8;i++ ){
 104   2              setSCL2(0); 
 105   2              delayUs(CONFIG_EPROM_FREQ);
 106   2                      setSCL2(1);
 107   2              receive <<= 1;
C51 COMPILER V9.59.0.0   I2C2                                                              12/15/2018 23:49:20 PAGE 3   

 108   2              if(getSDA2())
 109   2                              receive ++;   
 110   2                      delayUs(CONFIG_EPROM_FREQ); 
 111   2          }                                    
 112   1          if(!ack)
 113   1              iic2NAck();        //发送nACK
 114   1          else
 115   1              iic2Ack();         //发送ACK   
 116   1          return receive;
 117   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  8 ERROR(S)
