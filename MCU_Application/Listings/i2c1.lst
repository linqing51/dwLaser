C51 COMPILER V9.59.0.0   I2C1                                                              12/15/2018 23:49:19 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE I2C1
OBJECT MODULE PLACED IN .\Objects\i2c1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Driver\i2c1.c COMPACT OPTIMIZE(8,SPEED) REGFILE(.\Objects\dwLaser_F020.O
                    -RC) BROWSE ORDER INCDIR(.\Lib;.\Driver;.\MainApp;.\Modbus) DEBUG OBJECTEXTEND PRINT(.\Listings\i2c1.lst) OBJECT(.\Object
                    -s\i2c1.obj)

line level    source

   1          #include "i2c1.h"
   2          /*****************************************************************************/
   3          sbit SDA1 = P3^1;
*** ERROR C202 IN LINE 3 OF Driver\i2c1.c: 'P3': undefined identifier
   4          sbit SCL1 = P3^2;                               
*** ERROR C202 IN LINE 4 OF Driver\i2c1.c: 'P3': undefined identifier
   5          /*****************************************************************************/
   6          void iic1Init(void){
   7   1      
   8   1      }
   9          static void setSCL1(uint8_t s){
  10   1              if(s)
  11   1                      SCL1 = 1;
*** ERROR C202 IN LINE 11 OF Driver\i2c1.c: 'SCL1': undefined identifier
  12   1              else
  13   1                      SCL1 = 0;
*** ERROR C202 IN LINE 13 OF Driver\i2c1.c: 'SCL1': undefined identifier
  14   1      }
  15          static void setSDA1(uint8_t s){
  16   1              if(s)
  17   1                      SDA1 = 1;
*** ERROR C202 IN LINE 17 OF Driver\i2c1.c: 'SDA1': undefined identifier
  18   1              else
  19   1                      SDA1 = 0;
*** ERROR C202 IN LINE 19 OF Driver\i2c1.c: 'SDA1': undefined identifier
  20   1      }
  21          static uint8_t getSCL1(void){
  22   1              return SCL1;
*** ERROR C202 IN LINE 22 OF Driver\i2c1.c: 'SCL1': undefined identifier
  23   1      }
  24          static uint8_t getSDA1(void){
  25   1              return SDA1; 
*** ERROR C202 IN LINE 25 OF Driver\i2c1.c: 'SDA1': undefined identifier
  26   1      }
  27          void iic1Start(void){//产生IIC起始信号
  28   1              setSDA1(1);               
  29   1              setSCL1(1);
  30   1              delayUs(CONFIG_EPROM_FREQ);
  31   1              setSDA1(0);//START:when CLK is high,DATA change form high to low 
  32   1              delayUs(CONFIG_EPROM_FREQ);
  33   1              setSCL1(0);//钳住I2C总线，准备发送或接收数据 
  34   1      }         
  35          void iic1Stop(void){//产生IIC停止信号
  36   1              setSCL1(0);
  37   1              setSDA1(0);//STOP:when CLK is high DATA change form low to high
  38   1              delayUs(CONFIG_EPROM_FREQ);
  39   1              setSCL1(1); 
  40   1              setSDA1(1);//发送I2C总线结束信号
  41   1              delayUs(CONFIG_EPROM_FREQ);                                                             
  42   1      }
  43          
  44          uint8_t iic1WaitAck(void){
  45   1      //发送数据后，等待应答信号到来
C51 COMPILER V9.59.0.0   I2C1                                                              12/15/2018 23:49:19 PAGE 2   

  46   1      //返回值：1，接收应答失败，IIC直接退出
  47   1      //        0，接收应答成功，什么都不做
  48   1              uint8_t ucErrTime=0;  
  49   1              setSDA1(1);
  50   1              delayUs(1);        
  51   1              setSCL1(1);
  52   1              delayUs(1);      
  53   1              while(getSDA1()){
  54   2                      ucErrTime ++;
  55   2                      if(ucErrTime >= 250){
  56   3                              iic1Stop();
  57   3                              return 1;
  58   3                      }
  59   2              }
  60   1              setSCL1(0);    //时钟输出0         
  61   1              return 0;  
  62   1      }
  63          void iic1Ack(void){//产生ACK应答
  64   1              setSCL1(0);
  65   1              setSDA1(0);
  66   1              delayUs(CONFIG_EPROM_FREQ);
  67   1              setSCL1(1);
  68   1              delayUs(CONFIG_EPROM_FREQ);
  69   1              setSCL1(0);
  70   1      }
  71                      
  72          void iic1NAck(void){//不产生ACK应答     
  73   1              setSCL1(0);
  74   1              setSDA1(1);
  75   1              delayUs(CONFIG_EPROM_FREQ);
  76   1              setSCL1(1);
  77   1              delayUs(CONFIG_EPROM_FREQ);
  78   1              setSCL1(0);
  79   1      }                                                                                 
  80          void iic1SendByte(uint8_t txd){//IIC发送一个字节
  81   1      //返回从机有无应答
  82   1      //1，有应答
  83   1      //0，无应答                        
  84   1          uint8_t t;              
  85   1          setSCL1(0);//拉低时钟开始数据传输
  86   1          for(t = 0;t < 8;t ++)
  87   1          {              
  88   2              //SDA1=(txd&0x80)>>7;
  89   2                      if((txd & 0x80) >> 7)
  90   2                              setSDA1(1);
  91   2                      else
  92   2                              setSDA1(0);
  93   2                      txd <<= 1;        
  94   2                      delayUs(CONFIG_EPROM_FREQ);
  95   2                      setSCL1(1);
  96   2                      delayUs(CONFIG_EPROM_FREQ); 
  97   2                      setSCL1(0);     
  98   2                      delayUs(CONFIG_EPROM_FREQ);
  99   2          }    
 100   1      }           
 101            
 102          uint8_t iic1ReadByte(uint8_t ack){//读1个字节，ack=1时，发送ACK，ack=0，发送nACK 
 103   1              uint8_t i, receive=0;
 104   1          for(i=0;i<8;i++ ){
 105   2              setSCL1(0); 
 106   2              delayUs(CONFIG_EPROM_FREQ);
 107   2                      setSCL1(1);
C51 COMPILER V9.59.0.0   I2C1                                                              12/15/2018 23:49:19 PAGE 3   

 108   2              receive <<= 1;
 109   2              if(getSDA1())
 110   2                              receive ++;   
 111   2                      delayUs(CONFIG_EPROM_FREQ); 
 112   2          }                                    
 113   1          if(!ack)
 114   1              iic1NAck();        //发送nACK
 115   1          else
 116   1              iic1Ack();         //发送ACK   
 117   1          return receive;
 118   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  8 ERROR(S)
