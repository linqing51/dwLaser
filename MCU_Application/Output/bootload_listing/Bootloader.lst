C51 COMPILER V9.59.0.0   BOOTLOADER                                                        12/05/2018 17:20:29 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BOOTLOADER
OBJECT MODULE PLACED IN .\Output\bootload_output\Bootloader.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Bootloader\Bootloader.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Config;.\Lib;.
                    -\LibFlash;.\FlashEprom;.\Bootloader;.\Driver) DEFINE(C8051F340) DEBUG OBJECTEXTEND PRINT(.\Output\bootload_listing\Bootl
                    -oader.lst) PREPRINT(.\Output\bootload_listing\Bootloader.i) OBJECT(.\Output\bootload_output\Bootloader.obj)

line level    source

   1          
   2          #include "Bootloader.h"
*** WARNING C318 IN LINE 122 OF .\Config\appConfig.h: can't open file 'InitConfig.h'
*** WARNING C318 IN LINE 137 OF .\Config\appConfig.h: can't open file 'sPLC.h'
*** WARNING C318 IN LINE 138 OF .\Config\appConfig.h: can't open file 'modbusSlaveAscii.h'
   3          #include "Fxxx_EEPROM_Configuration.h"
   4          #include "Fxxx_EEPROM_Interface.h"
   5          //#define CONFIG_MCU_TYPE_C8051F340             1
   6          //#define CONFIG_APP_START_ADR                  0x1000//应用程序起始地址
   7          //#define CONFIG_APP_END_ADR                            0xFFFF//应用程序结束地址
   8          //#define CONFIG_
   9          //#ifdef CONFIG_MCU_TYPE_C8051F340 == 1
  10          //#include "F340_FlashUtils.h"
  11          //#endif
  12          //#define APP_START_ADR                                 0x1000
  13          
  14          
  15          
  16          void main (void);
  17          
  18          // Support Subroutines
  19          void receive_code(void);
  20          
  21          void (*appFunction)();//应用程序指针
  22          
  23          
  24          void main (void) 
  25          {
  26   1              uint8_t *pflash;
  27   1              uint8_t result[16];
  28   1              md5((uint8_t code*)(0x1000), 0x1000, result);
*** WARNING C206 IN LINE 28 OF Bootloader\Bootloader.c: 'md5': missing function-prototype
*** ERROR C267 IN LINE 28 OF Bootloader\Bootloader.c: 'md5': requires ANSI-style prototype
  29   1      //      pflash = 0x4000;
  30   1      //      //初始化MCU
  31   1      //      char i;
  32   1      //      SEGMENT_VARIABLE(rBuffer[EE_SIZE], U8, SEG_DATA);
  33   1      //      SEGMENT_VARIABLE(wBuffer[EE_SIZE], U8, SEG_DATA);
  34   1      //      U8 bufferCount;
  35   1      //      SFRPAGE_SWITCH()
  36   1      //      ENABLE_VDDMON()
  37   1      //      DISABLE_WDT()
  38   1      //      SFRPAGE_RESTORE()                       
  39   1      //   for(i = 0;i < EE_SIZE;i++)
  40   1      //      {
  41   1      //              wBuffer[i] = i;
  42   1      //      }
  43   1      //      // Read first byte of EEPROM
  44   1      //   if (EEPROM_ReadBlock(0, rBuffer, EE_SIZE) != EE_NO_ERROR)
  45   1      //   {
  46   1      //      while(1);      // Error reading EEPROM
  47   1      //   }
  48   1      //   
C51 COMPILER V9.59.0.0   BOOTLOADER                                                        12/05/2018 17:20:29 PAGE 2   

  49   1      //   // Write RAM buffer to EEPROM.
  50   1      //   if (EEPROM_WriteBlock (0, wBuffer, EE_SIZE) != EE_NO_ERROR)
  51   1      //   {
  52   1      //      while(1);      // Error writing EEPROM
  53   1      //   }
  54   1      
  55   1      //   // Read EEPROM contents back into RAM 
  56   1      //   if (EEPROM_ReadBlock(0, rBuffer, EE_SIZE) != EE_NO_ERROR)
  57   1      //   {
  58   1      //      while(1);      // Error reading EEPROM
  59   1      //   }
  60   1         while (1){
  61   2            //1秒内等待串口发出更新码
  62   2                //FLASH_Clear(CONFIG_APP_START_ADR, (CONFIG_APP_END_ADR - CONFIG_APP_START_ADR));
  63   2                 //检测到更新码
  64   2                //擦除FLASH
  65   2                //执行固件更新
  66   2                //执行应用程序
  67   2            
  68   2       
  69   2         }
  70   1      
  71   1      }
  72          
  73          //void loadAppFunction(void)
  74          //{
  75          //      //读取FEPROM中APP_HW MD5校正值
  76          //      if(f_valid){
  77          //      appFunction = (void code *) CONFIG_APP_START_ADR;//获取APP起始地址
  78          //      appFunction();//执行应用程序
  79          //}
  80          

C51 COMPILATION COMPLETE.  4 WARNING(S),  1 ERROR(S)
